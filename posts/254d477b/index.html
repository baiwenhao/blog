<!DOCTYPE html>
          <head>
        <meta charset="utf-8">
            
            <title>
                node | wenhao blog
            </title>
            <meta content="width=device-width, initial-scale=1" name="viewport">
            <meta name="theme-color" content="#4184f3">
            
            
            <link href="/favicon.ico" rel="icon"/>
            

            <link rel="stylesheet" href="/css/highlight.light.css">
            <link rel="stylesheet" href="/css/prism-customize.css">
            <link rel="stylesheet" href="/css/nav-icon.css">
            <link rel="stylesheet" href="/css/waves.min.css">
            <link rel="stylesheet" href="/css/jquery.tocify.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/nav-indicator.css">
            
  

  
            </meta>
        </meta>
    <link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

    <body>
        <header>
            <!-- cover image or sth. -->
        </header>
        <div id="main" class="m-scene">
            
<div class="nav-wrapper">

    <div class="container">
        <nav>
            <div class="logo wave">
                <a href="/" id="logo">
                    wenhao blog
                </a>
            </div>
            <div class="nav-toggle-icon" >
                <div class="material-hamburger">
                    <span>
                    </span>
                    <span>
                    </span>
                    <span>
                    </span>
                </div>
            </div>
            <div class="menu-wrapper">
                <div class="nav-indicator">
                </div>
                <ul class="menus">
                    
                     
                        <li>
                            <a class="wave " href="/">
                                首页
                            </a>
                        </li>
                     
                        <li>
                            <a class="wave " href="/archives">
                                归档
                            </a>
                        </li>
                     
                        <li>
                            <a class="wave " href="/about">
                                关于
                            </a>
                        </li>
                     
                        <li>
                            <a class="wave no-smoothstate" href="/atom.xml">
                                订阅
                            </a>
                        </li>
                     
                    
                   
                </ul>
            </div>
        </nav>
    </div>
</div>
            <div class="container content">
                <div class="scene_element scene_element--fadein">
                    <div class="row">
    <div class="main">
        <article>
          
          <header class="post-header">
          
          </header>
          <h1 class="post-title">node</h1>

          <section class="post-info">
            <span class="post-date">2017/02/07</span>
            
            
          </section>

          <section class="post-content">
            <h2 id="form-data"><a href="#form-data" class="headerlink" title="form-data"></a>form-data</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 前端发送 formData 请求</span></span><br><span class="line"><span class="keyword">const</span> postData = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> fd = <span class="keyword">new</span> FormData()</span><br><span class="line">  fd.append(<span class="string">'buId'</span>, <span class="string">'官网'</span>)</span><br><span class="line">  fd.append(<span class="string">'occurDate'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>().getTime())</span><br><span class="line">  <span class="keyword">const</span> x = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">  x.open(<span class="string">'post'</span>, <span class="string">'/downCount'</span>)</span><br><span class="line">  x.send(fd)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务端解析</span></span><br><span class="line"><span class="keyword">const</span> multipart = <span class="built_in">require</span>(<span class="string">'connect-multiparty'</span>)</span><br><span class="line"><span class="keyword">const</span> multipartMiddleware = multipart()</span><br><span class="line">app.post(<span class="string">'/downCount'</span>, multipartMiddleware, (req, res) =&gt; &#123;</span><br><span class="line">  res.send(req.body)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务端发送post 解决跨域</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// https://stackoverflow.com/questions/27190447/pass-json-to-http-post-request/27190736</span></span><br></pre></td></tr></table></figure>
<p>// 看看<br>// <a href="https://blog.csdn.net/yiyanbuhe/article/details/79105287" target="_blank" rel="noopener">https://blog.csdn.net/yiyanbuhe/article/details/79105287</a></p>
<p><a href="http://yijiebuyi.com/blog/90c1381bfe0efb94cf9df932147552be.html" target="_blank" rel="noopener">http://yijiebuyi.com/blog/90c1381bfe0efb94cf9df932147552be.html</a></p>
<h2 id="io"><a href="#io" class="headerlink" title="io"></a>io</h2><ol>
<li>斐波那契数列</li>
</ol>
<h2 id="path"><a href="#path" class="headerlink" title="path"></a>path</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">path.join(<span class="string">'/foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz/asdf'</span>, <span class="string">'quux'</span>, <span class="string">'..'</span>)</span><br><span class="line"><span class="string">'/foo/bar/baz/asdf'</span></span><br><span class="line"></span><br><span class="line">path.normalize(<span class="string">'/foo/bar//baz/asdf/quux/..'</span>)</span><br><span class="line"><span class="string">'/foo/bar/baz/asdf'</span></span><br><span class="line"></span><br><span class="line">path.resolve(__dirname, <span class="string">'../../'</span>)</span><br><span class="line"></span><br><span class="line">path.posix 返回POSIX(Mac/Linux)系统的path执行</span><br></pre></td></tr></table></figure>
<p>path.basename 获取路径的名称（最后一部分）<br>path.delimiter 返回当前操作系统多个路径的分隔符<br>path.dirname 获取路径的父文件夹路径<br>path.extname 返回文件路径的扩展名<br>path.isAbsolute 判断是否是绝对路径<br>path.join 连接两个或多个路径<br>path.normalize 将路径中的’.’和’..’转化成最终的路径<br>path.relative 返回一个路径针对另一个路径的相对路径<br>path.resolve 按照多个路径的值返回最终的路径<br>path.seq 返回操作系统路径文件夹分隔符<br>path.win32 返回Windows系统的path执行</p>
<p>参考:<br><a href="http://nodejs.cn/api/path.html#path_path_posix" target="_blank" rel="noopener">http://nodejs.cn/api/path.html#path_path_posix</a><br><a href="http://wiki.jikexueyuan.com/project/nodejs/path.html" target="_blank" rel="noopener">http://wiki.jikexueyuan.com/project/nodejs/path.html</a><br><a href="http://www.jianshu.com/p/d2c96d295d48" target="_blank" rel="noopener">http://www.jianshu.com/p/d2c96d295d48</a></p>
<h2 id="url"><a href="#url" class="headerlink" title="url"></a>url</h2><p>url.parse()</p>
<h2 id="process"><a href="#process" class="headerlink" title="process"></a>process</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PORT=8888 node app.js // 当前生效</span><br><span class="line">export PORT=8888 // 永久生效</span><br><span class="line">process.env.PORT // 获取node进程携带的变量</span><br><span class="line">process.stdout.write(&apos;打印&apos;)</span><br><span class="line">process.cwd() 路径</span><br></pre></td></tr></table></figure>
<p><img src="/posts/254d477b/1.png" alt="logo"></p>
<h2 id="package"><a href="#package" class="headerlink" title="package"></a>package</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">multer ?</span><br><span class="line">https://github.com/pillarjs/multiparty</span><br><span class="line"></span><br><span class="line">nodejs中的jQuery</span><br><span class="line">https://www.npmjs.com/package/cheerio</span><br><span class="line"></span><br><span class="line">request加载一个url源码</span><br><span class="line">https://www.npmjs.com/package/request</span><br><span class="line"></span><br><span class="line">异步函数</span><br><span class="line">https://www.npmjs.com/package/async</span><br><span class="line"></span><br><span class="line">增删改查json对象</span><br><span class="line">https://www.npmjs.com/package/lei-ns</span><br><span class="line"></span><br><span class="line">连接mongoose数据库</span><br><span class="line">https://www.npmjs.com/package/mongoose</span><br><span class="line"></span><br><span class="line">处理json对象，可以加密</span><br><span class="line">console.log($.utils.md5(&apos;haha&apos;))</span><br><span class="line">https://www.npmjs.com/package/project-core</span><br><span class="line"></span><br><span class="line">ProjectCore </span><br><span class="line">加密字符</span><br><span class="line">加载文件和文件夹</span><br><span class="line">json对象</span><br><span class="line">https://www.npmjs.com/package/project-core</span><br><span class="line"></span><br><span class="line">验证码</span><br><span class="line">https://www.npmjs.com/package/captcha.js</span><br><span class="line"></span><br><span class="line">// to do</span><br><span class="line">http://ourjs.com/detail/56162a63e3312b046d27f53e</span><br><span class="line"></span><br><span class="line">webpack </span><br><span class="line">http://crossingmay.com/2016/05/28/webpackshim/</span><br></pre></td></tr></table></figure>
<h2 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h2><p>计算文件哈希值，需要使用crypto模块中的Hash类。Hash类是一个可读写的Stream流，要计算文件的哈希值首先要读取文件并创建一个Stream。在Node.js中，操作文件使用的fs模块。以下是一个计算文件MD5值的示例</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//从文件创建一个可读流</span></span><br><span class="line"><span class="keyword">var</span> stream = fs.createReadStream(<span class="string">'./mindpush.apk'</span>)</span><br><span class="line"><span class="keyword">var</span> fsHash = crypto.createHash(<span class="string">'md5'</span>)</span><br><span class="line"></span><br><span class="line">stream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">    fsHash.update(d)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">stream.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> md5 = fsHash.digest(<span class="string">'hex'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"文件的MD5是：%s"</span>, md5)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在上面的示例中，基于流事件监听创建并更新文件哈希流。hash.update方法，默认传入数据类型为Buffer。使用fs模块的fs.readFile或fs.readFileSync方法，可以从文件读取一个文件的Buffer。因此，以上代码可以简化为</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取一个Buffer</span></span><br><span class="line"><span class="keyword">var</span> buffer = fs.readFileSync(<span class="string">'./mindpush.apk'</span>)</span><br><span class="line"><span class="keyword">var</span> fsHash = crypto.createHash(<span class="string">'md5'</span>)</span><br><span class="line"></span><br><span class="line">fsHash.update(buffer)</span><br><span class="line"><span class="keyword">var</span> md5 = fsHash.digest(<span class="string">'hex'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"文件的MD5是：%s"</span>, md5)</span><br></pre></td></tr></table></figure>
<p>Hash类除可以计算文件MD5值外，还可用于计算文件的’sha1’、’sha256’、’sha512’等值，使用时修改crypto.createHash(‘md5’)方法的传入参数即可<br>// <a href="https://itbilu.com/nodejs/npm/Nk-6MeQ9.html" target="_blank" rel="noopener">https://itbilu.com/nodejs/npm/Nk-6MeQ9.html</a></p>
<h2 id="pm2"><a href="#pm2" class="headerlink" title="pm2"></a>pm2</h2><p><a href="http://pm2.keymetrics.io/" target="_blank" rel="noopener">http://pm2.keymetrics.io/</a><br>启动参数<br>–watch 监听变化自动重启<br>-i –instances 启动多少个实例，用于负载均衡<br>-n –name 应用名称<br>-o –output <path></path> 标准输出日志文件的路径。<br>-e –error <path></path> 错误输出日志文件的路径</p>
<p>重启<br>pm2 restart appjs</p>
<p>停止<br>pm2 stop app_name | app_id</p>
<p>查看进程配置信息<br>pm2 describe 0</p>
<p>配置信息<br>{<br>  “name”        : “fis-receiver”,  // 应用名称<br>  “script”      : “./bin/www”,  // 实际启动脚本<br>  “cwd”         : “./“,  // 当前工作路径<br>  “watch”: [  // 监控变化的目录，一旦变化，自动重启<br>    “bin”,<br>    “routers”<br>  ],<br>  “ignore_watch” : [  // 从监控目录中排除<br>    “node_modules”,<br>    “logs”,<br>    “public”<br>  ],<br>  “watch_options”: {<br>    “followSymlinks”: false<br>  },<br>  “error_file” : “./logs/app-err.log”,  // 错误日志路径<br>  “out_file”   : “./logs/app-out.log”,  // 普通日志路径<br>  “env”: {<br>      “NODE_ENV”: “production”  // 环境参数，当前指定为生产环境<br>  }<br>}</p>
<p>环境配置<br>“env”: {<br>  “NODE_ENV”: “production”,<br>  “REMOTE_ADDR”: “<a href="http://www.example.com/" target="_blank" rel="noopener">http://www.example.com/</a>“<br>},<br>“env_dev”: {<br>  “NODE_ENV”: “development”,<br>  “REMOTE_ADDR”: “<a href="http://wdev.example.com/" target="_blank" rel="noopener">http://wdev.example.com/</a>“<br>},<br>“env_test”: {<br>  “NODE_ENV”: “test”,<br>  “REMOTE_ADDR”: “<a href="http://wtest.example.com/" target="_blank" rel="noopener">http://wtest.example.com/</a>“<br>}</p>
<p>启动指明环境<br>pm2 start app.js –env dev</p>
<p>监控<br>pm2 monit</p>
<p>内存使用超过上限自动重启<br>pm2 start app.js –max-memory-restart 20M</p>
<p>pm2编程接口<br><a href="http://pm2.keymetrics.io/docs/usage/pm2-api/" target="_blank" rel="noopener">http://pm2.keymetrics.io/docs/usage/pm2-api/</a></p>
<p>参考<br><a href="http://www.cnblogs.com/chyingp/p/pm2-documentation.html" target="_blank" rel="noopener">http://www.cnblogs.com/chyingp/p/pm2-documentation.html</a></p>
<h2 id="querystring"><a href="#querystring" class="headerlink" title="querystring"></a>querystring</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> info = &#123;</span><br><span class="line">  appid: <span class="string">'wx123'</span>,</span><br><span class="line">  scope: <span class="string">'snsapi_base'</span>,</span><br><span class="line">  response_type: <span class="string">'code'</span></span><br><span class="line">&#125;</span><br><span class="line">querystring.stringify(info)</span><br></pre></td></tr></table></figure>
<h2 id="momentjs"><a href="#momentjs" class="headerlink" title="momentjs"></a>momentjs</h2><p>moment().format(‘YYYY-MM-DD’) // <a href="http://momentjs.com/docs/" target="_blank" rel="noopener">http://momentjs.com/docs/</a></p>
<h2 id="gd-gif"><a href="#gd-gif" class="headerlink" title="gd-gif"></a>gd-gif</h2><p>nodejs 生成验证码</p>

          </section>
        </article>
        

       
        <div class="pager">
          
            <a class="post-prev pager-item" href="/posts/f8e09374/" >
              <strong class="article-nav-caption">上一篇</strong>
              <p class="post-nav-title">vue</p>
            </a>
          
          
            <a class="post-next pager-item" href="/posts/53d0684b/">
              <strong class="article-nav-caption">下一篇</strong>
              <p class="post-nav-title">linux</p>
            </a>
          
        </div>
        

         <!-- comments -->
        <div class="comment-section">
  
    


  


</div>

    </div>
    
</div>

                </div>
            </div>
        </div>
        <footer class="footer">
    <p>
        &copy; 2021 wenhao blog
    </p>
</footer>
<script src="/lib/jquery.js"></script>
<script src="/lib/waves.js"></script>
<script src="/lib/jquery-ui.js"></script>
<script src="/lib/jquery.tocify.js"></script>
<script src="/js/main.js"></script>

    </body>
</html>
